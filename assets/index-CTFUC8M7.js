var z=Object.defineProperty;var F=(i,t,n)=>t in i?z(i,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[t]=n;var y=(i,t,n)=>F(i,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(e){if(e.ep)return;e.ep=!0;const s=n(e);fetch(e.href,s)}})();function U(i,t,n,o,e,s=!1){const c=(i-t)*(e-o)/(n-t)+o;return s?o<e?Math.min(Math.max(c,o),e):Math.min(Math.max(c,e),o):c}function G(i){for(const t of i.children)i.removeChild(t)}const R={minimalist:"#+-.",normal:"@%#*+=-:.",normal2:"&$Xx+;:.",alphabetic:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",alphanumeric:"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890abcdefghijklmnopqrstuvwxyz",numerical:"0896452317",extended:"@%#{}[]()<>^*+=~-:.",math:"+-×÷=≠≈∞√π",arrow:"↑↗→↘↓↙←↖",grayscale:"@$BWM#*oahkbdpwmZO0QCJYXzcvnxrjft/|()1{}[]-_+~<>i!lI;:,\"^`'.",max:"ÆÑÊŒØMÉËÈÃÂWQBÅæ#NÁþEÄÀHKRŽœXgÐêqÛŠÕÔA€ßpmãâG¶øðé8ÚÜ$ëdÙýèÓÞÖåÿÒb¥FDñáZPäšÇàhû§ÝkŸ®S9žUTe6µOyxÎ¾f4õ5ôú&aü™2ùçw©Y£0VÍL±3ÏÌóC@nöòs¢u‰½¼‡zJƒ%¤Itocîrjv1lí=ïì<>i7†[¿?×}*{+()/»«•¬|!¡÷¦¯—^ª„”“~³º²–°­¹‹›;:’‘‚’˜ˆ¸…·¨´`",codepage437:"█▓▒░",blockelement:"█",GIOBOTTI_grayscale:"@$BWM#*oahkbdpwmZO0QCJYXzcvnxrjft/|()1{}[]-_+~<>i!lI;:,\"^`'.             "},$=R.GIOBOTTI_grayscale,N=k(255,255,255),O=.6;function S(i,t,n){return Math.floor(i*t/n)}function H(i,t,n,o,e){let s="";const c=i.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error;const a=i.width/t,l=i.height/n,g=((e==null?void 0:e.dict)??$).split("");for(let d=0;d<n;d++){for(let u=0;u<t;u++){const E=c.getImageData(Math.floor(u*a),Math.floor(d*l),Math.floor(a),Math.floor(l)),b=X(E);let{r:h,g:r,b:p}=b;e!=null&&e.reverse&&(h=255-h,r=255-r,p=255-p);const w=k(h,r,p);let m=Math.floor(U(w,0,N,0,g.length));m>=g.length&&(m=g.length-1);const v=g[m];if(o){const C=o.getSpan(u,d);if(!C)continue;e!=null&&e.color&&(C.style.color=`rgb(${h}, ${r}, ${p})`),C.textContent=v}s+=v}s+=`
`}return s}function X(i){const t=i.data;let n=0,o=0,e=0;for(let c=0;c<t.length;c+=4)n+=t[c],o+=t[c+1],e+=t[c+2];const s=t.length/4;if(n=Math.round(n/s),o=Math.round(o/s),e=Math.round(e/s),n>255||o>255||e>255)throw new Error;return{r:n,g:o,b:e}}function k(i,t,n){return Math.round(.299*i+.587*t+.114*n)}class j{constructor(t,n,o,e=!1){y(this,"spans");this.width=t,this.height=n,this.container=o,e&&(o.textContent="",G(o)),this.spans=[];for(let s=0;s<n;s++){const c=[];for(let a=0;a<t;a++){const l=document.createElement("span");l.textContent=[":",")"," "][Math.floor(Math.random()*2.9)],c.push(l),this.container.appendChild(l)}this.container.appendChild(document.createElement("br")),this.spans.push(c)}}getSpan(t,n){if(t<0||t>=this.width||n<0||n>=this.height){console.error({x:t,y:n,width:this.width,height:this.height});return}return this.spans[n][t]}}class q{constructor(t,n,o,e,s,c){y(this,"width");y(this,"height");y(this,"asciiWidth");y(this,"playing",!1);this.canvas=t,this.context=n,this.video=o,this.asciiHeight=e,this.charAspectRatio=s,this.options=c,this.video.play(),this.width=this.options.width??this.canvas.width,this.height=this.options.height??this.canvas.height;const a=this.width/this.height;this.asciiWidth=S(this.asciiHeight,a,this.charAspectRatio)}startAnimation(){this.playing||(this.video.play(),this.playing=!0,D(this))}stopAnimation(){this.video.pause(),this.playing=!1}_frame(){const t=this.width,n=this.height;if(this.context.drawImage(this.video,0,0,t,n),this.options.textCallback){const o=H(this.canvas,this.asciiWidth,this.asciiHeight,this.options.spanGrid,{color:this.options.color,dict:this.options.dict});this.options.textCallback(o)}}}function D(i){i.playing&&(i._frame(),requestAnimationFrame(()=>D(i)))}const J=document.getElementById("form"),Q=document.getElementById("files"),I=document.getElementById("hidden"),f=document.getElementById("canvas"),x=document.getElementById("color-export"),V=document.getElementById("input-height"),M=document.getElementById("input-darkmode"),Y=document.getElementById("input-bold"),Z=document.getElementById("input-color"),L=document.getElementById("input-font-size"),B=document.getElementById("ascii-custom"),T=document.getElementById("ascii-dict");async function K(){await J.addEventListener("submit",et)}function tt(){return{asciiHeight:parseInt(V.value),darkMode:M.checked,bold:Y.checked,color:Z.checked,asciiDict:B.value}}M.addEventListener("change",()=>{M.checked?(document.body.classList.remove("light"),document.body.classList.add("dark")):(document.body.classList.add("light"),document.body.classList.remove("dark"))});P();T.addEventListener("change",P);function P(){const i=R[T.value];i&&(B.disabled=!1,B.value=i)}L.addEventListener("input",_);L.addEventListener("change",_);function _(){const i=parseInt(L.value)/10;x.style.fontSize=`${i}rem`}async function et(i){var b;i.preventDefault();const t=tt();x.style.fontWeight=t.bold?"bold":"normal";const n=((b=Q.files)==null?void 0:b.item(0))??void 0;if(!n)return;let o,e,s,c;if(n.type.startsWith("image")){e="image";const h=URL.createObjectURL(n),r=document.createElement("img");r.src=h,A(I),I.appendChild(r),await new Promise((w,m)=>{r.onload=()=>w(),r.onerror=v=>m(v)}),s=r.width,c=r.height,o=r}else if(n.type.startsWith("video")){e="video";const h=URL.createObjectURL(n),r=document.createElement("video");r.loop=!0,r.muted=!0,r.src=h,A(I),I.appendChild(r),await new Promise((w,m)=>{r.onloadeddata=()=>w(),r.onerror=v=>m(v)}),s=r.videoWidth,c=r.videoHeight,o=r}else throw new Error;const a=s/c,l=400,g=400/a,d=t.asciiHeight,u=S(d,a,O);f.width=l,f.height=g;const E=new j(u,d,x,!0);e==="image"?(W().drawImage(o,0,0,f.width,f.height),H(f,u,d,E,{color:!0,dict:t.asciiDict})):e==="video"&&new q(f,W(),o,d,O,{textCallback:r=>{},spanGrid:E,color:t.color,dict:t.asciiDict}).startAnimation()}function W(){const i=f.getContext("2d");if(!i)throw new Error("ah!");return i}function A(i){for(const t of i.children)i.removeChild(t)}K();
